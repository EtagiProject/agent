<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Google Drive API Example</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    let CLIENT_ID = '1X4eDl6BzIkLZCAKfmzIp6YSGPEUcUkqH';
    let API_KEY = 'AIzaSyCbkNvxP39IbvNsGx3xmVc-Q01a6WHJ7kg';
    let DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
    let SCOPES = 'https://www.googleapis.com/auth/drive';

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(() => {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      }, error => {
        console.log(JSON.stringify(error, null, 2));
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        listFiles();
      } else {
        gapi.auth2.getAuthInstance().signIn();
      }
    }

    function listFiles() {
      gapi.client.drive.files.list({
        'pageSize': 10,
        'fields': "nextPageToken, files(id, name)"
      }).then(response => {
        let files = response.result.files;
        if (files && files.length > 0) {
          files.forEach(file => {
            let node = document.createElement("div");
            node.textContent = `${file.name} (${file.id})`;
            document.getElementById('content').appendChild(node);
          });
        } else {
          document.getElementById('content').textContent = 'No files found.';
        }
      });
    }
  </script>
</head>
<body>
  <button onclick="handleClientLoad()">Авторизоваться</button>
  <div id="content"></div>
</body>
</html>
